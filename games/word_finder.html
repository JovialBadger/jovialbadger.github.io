---
# Feel free to add content and custom Front Matter to this file.
# To modify the layout, see https://jekyllrb.com/docs/themes/#overriding-theme-defaults

layout: SiteMaster
nav: "1"
title: "Word Finder"
path: "Games/Word_Finder"
breadcrumbs: "1"
hasfocusmode: "1"
---
<script src="javascript/words.js?{{ site.version_number }}"></script>
<style>
	#grid-guess>div {
		display: grid;
		/*grid-template-columns: 1fr 1fr 1fr 1fr 1fr;*/
		gap: 3px;
		background-color: var(--main-color);
		padding: 3px;
		max-width:1000px;
		margin: auto;
	}

	#grid-guess>div>div, #grid-container>div {
		background-color: rgba(255, 255, 255, 0.8);
		text-align: center;
		padding: 10px 0;
		font-size: 30px;
	}
	#grid-container {
		max-width:1500px;
		margin: auto;
		display: grid;
		grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
		gap: 3px;
		background-color: var(--main-color);
		padding: 3px;
	}
</style>
		Word Length: <input id="inpWordLength" type="number" min="4" max="12" value="5" onblur="changeWordLength(this.value)">
		<div><span style="padding:10px;display:inline-block; background-color:#0f0;" onclick="initWordFinder()">New Game</span> <span style="padding:10px;display:inline-block; background-color:#0f0;" onclick="initWordFinder(true)">Daily Word</span> <span style="float:right;padding:10px;" id="gameStats"></span></div>
		<hr/>
		<div onclick="focusInput()">
			<div id="grid-guess"></div>
			<hr/>
			<div id="wordFinderDefinition" style="text-align:center;"></div>
			<hr/>
			<div id="grid-container"></div>
		</div>
		<input id="inputFocus" style="height:1px;width:1px;border:none;top:0;right:0;padding:0; opacity:0;" readonly onkeyup="keyboardCapture(event)">
		<span id="downloadGame" style="padding:10px;display:inline-block; background-color:#0f0;display:none;" onclick="candown('canvasWordFinderExport', 'png')">Download Finished Game</span>
		<script>
			var isDaily = false;
			var resettable = true;
			var wordLengths = 5; //min 4 max 9
			var sucess = false;
			var chosenWord = "";
			var currentGuess = 0;
			var currentLetter = 0;
			var guessedLetters = [];
			var wins = 0;
			var losses = 0;
			var totWins = 0;
			var totLosses = 0;
			var winStreak = 0;
			var totWinStreak = 0;
			const keyBoard = [{"L":"q","O":1},{"L":"w","O":2},{"L":"e","O":3},{"L":"r","O":4},{"L":"t","O":5},{"L":"y","O":6},{"L":"u","O":7},{"L":"i","O":8},{"L":"o","O":9},{"L":"p","O":10},{"L":"a","O":11},{"L":"s","O":12},{"L":"d","O":13},{"L":"f","O":14},{"L":"g","O":15},{"L":"h","O":16},{"L":"j","O":17},{"L":"k","O":18},{"L":"l","O":19},{"L":":)","O":19.5,"A":"span 2"},{"L":"z","O":20},{"L":"x","O":21},{"L":"c","O":22},{"L":"v","O":23},{"L":"b","O":24},{"L":"n","O":25},{"L":"m","O":26},{"L":"<=","O":26.5, "A":"auto / span 2"}];
			var gameState = {"state":0};
			
			function focusInput(){
				getElem('inputFocus').focus();
			}
			
			function changeWordLength(val){
				val = (val * 1) || 5;
				val = val < 4 ? 4 : val;
				val = val > 12 ? 12 : val
				getElem("inpWordLength").value = val;
				if(resettable || (currentGuess == 0 && currentLetter == 0)){
					wins = 0;
					losses = 0;
					wordLengths = val;
					resettable = true;
					initWordFinder();
				}else{
					getElem("inpWordLength").value = wordLengths;
					toastyMake("Finish Game First");
				}
			}

			function initWordFinder(fromSeed) {		
				fromSeed = fromSeed || false;
				if(resettable){
					displayNoneByID("downloadGame");
					getElem("wordFinderDefinition").innerHTML = "";
					chosenWord = "";
					gameState = {"state":0};
					losses = 0;
					wins = 0;
					totWins = 0;
					totLosses = 0;
					winStreak = 0;
					totWinStreak = 0;
					gameState = getLocal("wordFinderGameState") ? JSON.parse(getLocal("wordFinderGameState")) : gameState;
					if("ChosenWord" in gameState){
						chosenWord = window.atob(gameState.ChosenWord);
						wordLengths = chosenWord.split("").length;
						isDaily = gameState.IsDaily;
					}
					losses = getLocal("wordFinderLosses" + wordLengths) ? getLocal("wordFinderLosses" + wordLengths) : losses;
					wins = getLocal("wordFinderWins" + wordLengths) ? getLocal("wordFinderWins" + wordLengths) : wins;
					totWins = getLocal("wordFinderTotWins") ? getLocal("wordFinderTotWins") : totWins;
					totLosses = getLocal("wordFinderTotLosses") ? getLocal("wordFinderTotLosses") : totLosses;
					winStreak = getLocal("wordFinderWinStreak" + wordLengths) ? getLocal("wordFinderWinStreak" + wordLengths) : winStreak;
					totWinStreak = getLocal("wordFinderTotWinStreak") ? getLocal("wordFinderTotWinStreak") : totWinStreak;
					resettable = false;
					setResults();
					focusInput();
					sucess = false;
					guessedLetters = [];
					currentGuess = 0;
					currentLetter = 0;
					if(chosenWord == ""){
						var x = words.filter(function(t) {
							return t.L == wordLengths;
						});
						x = x.concat(wordDelta.filter(function(t) {
							return t.L == wordLengths;
						}));
						//console.log(x);
						var lastDaily = new Date(getLocal("wordFinderLastDaily") ? getLocal("wordFinderLastDaily") : 0);
						var today = new Date(UTCString());
						if(fromSeed && lastDaily.getTime() < today.getTime()){
							isDaily = true;
							chosenWord = x[Math.floor(randSeed(UTCString()) * (x.length + 1))].W;
						}else{
							fromSeed ? toastyMake("Daily Word Complete") : null;
							isDaily = false;
							chosenWord = x[Math.floor(Math.random() * x.length)].W;
						}
						gameState.IsDaily = isDaily;
					}
					//console.log(chosenWord);
					var y = getElem('grid-guess');
					var d = "";
					var frames = "";
					for (var a = 0; a < (wordLengths + 1); a++) {
						d += "<div id='guess-word-" + a + "'>";
						for (var b = 0; b < wordLengths; b++) {
							d += "<div class='letter-" + b + "'>&nbsp;</div>";
							if(a == 0){
								frames += " 1fr";
							}
						}
						d += "</div>";
					}
					y.innerHTML = d;
					getElem('adjustWordsTable').innerHTML = "#grid-guess>div {grid-template-columns:" + frames + ";}"
					makeKeyBoard();
					if(("Words" in gameState)  && gameState.Words.length > 0){
						for (var i = 0; i < gameState.Words.length; i++) {
							var inputWordLetters = gameState.Words[i].split("");
							for (var j = 0; j < inputWordLetters.length; j++) {
								enterKey(inputWordLetters[j]);
							}
							enterKey(":)");
						}
					}
				} else{
					toastyMake("Finish Game First");
				}
			}
			
			function makeKeyBoard(){
				var wordChars = chosenWord.toUpperCase().split("");
				var z = getElem('grid-container');
				var e = "";
				for (var c = 0; c < keyBoard.length; c++) {
					var thisLetter = keyBoard[c].L.toUpperCase();
					e += "<div onclick='enterKey(\"" + thisLetter + "\")' style='" + (guessedLetters.indexOf(thisLetter) > -1 ? "background-color: " + (wordChars.indexOf(thisLetter) > -1 ? ((chosenWord.toUpperCase().match(new RegExp(thisLetter, "g")) || []).length > 1 ? "#f80" : "#0f0"):"#999") + ";" : "") + (keyBoard[c].A ? "grid-area:" + keyBoard[c].A + ";" : "") + "'>" + thisLetter + "</div>";
				}
				z.innerHTML = e;			
			}
			
			function keyboardCapture(e){
				var key=e.keyCode || e.which;
				switch(key){
					case 13:
						enterKey(":)");
						break;
					case 8:
						enterKey("<=");
						break;
					default:
						enterKey(String.fromCharCode(key).toUpperCase());
						break;
				}
				getElem('inputFocus').value = "";
			}
			
			function setResults(){
				getElem('gameStats').innerHTML = "Wins: " + wins + " | Losses: " + losses + "<br/>Tot Wins: " + totWins + " | Tot Losses: " + totLosses + "<br/>Streak: " + winStreak + " | Tot Streak: " + totWinStreak;
				losses == 0 ? null : setLocal("wordFinderLosses" + wordLengths, losses);
				wins == 0 ? null : setLocal("wordFinderWins" + wordLengths, wins);
				totWins == 0 ? null :  setLocal("wordFinderTotWins", totWins);
				totLosses == 0 ? null : setLocal("wordFinderTotLosses", totLosses);
				winStreak == 0 ? null : setLocal("wordFinderWinStreak" + wordLengths, winStreak);
				totWinStreak == 0 ? null : setLocal("wordFinderTotWinStreak", totWinStreak);
				setLocal("wordFinderGameState",  JSON.stringify(gameState));
			}
			
			function enterKey(letter){
				if(sucess == true){
					toastyMake("sucess, please start new game");
					return;
				}
				if(currentGuess == (wordLengths + 1)){
					toastyMake("Failed, please start new game. Word: " + chosenWord);
					return;
				}
				setResults();
				var ok = false;
				var letters = keyBoard.filter(function (item) {return item.L.toUpperCase() == letter;});
				if(letters.length > 0){
					var elem = getElem('guess-word-' + currentGuess);
					ok = true;
					switch(letter){
						case ":)":
							if(currentLetter == wordLengths){
								var word = "";
								for (var b = 0; b < wordLengths; b++) {
									word += getClass("letter-" + b,elem)[0].innerHTML;
								}
								if(!("Words" in gameState)){gameState.Words = [];}								
								gameState.Words[currentGuess] = word;
								gameState.ChosenWord = window.btoa(chosenWord);
								var x = words.filter(function(t) {
									return t.L == wordLengths;
								});
								x = x.concat(wordDelta.filter(function(t) {
									return t.L == wordLengths;
								}));
								var isWord = x.filter(function (item) {return item.W.toUpperCase() == word;});
								if(isWord.length > 0){						
									guessedLetters = guessedLetters.concat(word.split(""));
									makeKeyBoard();
									if(word == chosenWord.toUpperCase()){								
										for (var y = 0; y < wordLengths;y++) {
											getClass("letter-" + y,elem)[0].style.background = "#0f0";
										}
										isDaily ? setLocal("wordFinderLastDaily",  UTCString()) : null;
										createCanvasImage();
										gameState = {"state":0};
										displayBlockByID("downloadGame");
										sucess = true;
										wins++;
										totWins++;
										totWinStreak++;
										winStreak++;
										resettable = true;
										findDefinition();
										toastyMake("Correct :)");
									} else{			
										var wordChars = chosenWord.toUpperCase().split("");
										for (var z = 0; z < wordLengths; z++) {
											var letterElem = getClass("letter-" + z,elem)[0];
											var lettercheck = letterElem.innerHTML;
											letterElem.style.background = (wordChars[z] == lettercheck ? "#0f0" : (wordChars.indexOf(lettercheck) > -1 ? "#ff0" : ""));
										}
										if(currentGuess == wordLengths){ 
											isDaily ? setLocal("wordFinderLastDaily",  UTCString()) : null;
											createCanvasImage();
											gameState = {"state":0};
											displayBlockByID("downloadGame");
											losses++;
											totLosses++;
											totWinStreak = 0;
											winStreak = 0;
											delLocal("wordFinderWinStreak");
											delLocal("wordFinderTotWinStreak");											
											resettable = true;
											findDefinition();
											toastyMake("Failed! Word: " + chosenWord);
										} else{
											toastyMake("Try Again");
										}
										currentGuess++;
										currentLetter = 0;
									}
								} else{
									toastyMake("Word Not Found!");
								}
							} else{toastyMake("Please Fill All Letters");}
							break;
						case "<=":
							currentLetter--;
							currentLetter = currentLetter < 0 ? 0 : currentLetter;
							getClass("letter-" + currentLetter,elem)[0].innerHTML = "&nbsp;";
							break;
						default:
							if(currentLetter < wordLengths){
								getClass("letter-" + currentLetter,elem)[0].innerHTML = letter;
								currentLetter++;
								currentLetter = currentLetter > wordLengths ? wordLengths : currentLetter;
							}
							break;
					}					
					setResults();
				}
			}
			function findDefinition(){
				getElem("wordFinderDefinition").innerHTML = "Find out more about the word <u><a href='https://en.wiktionary.org/wiki/" + chosenWord + "' target='definitionsJovialBadger'>" + chosenWord + "</a></u>";
			}
			docReady(function () {
				initWordFinder(true);
			});
			function candown(target, type) {
				let canvas = getElem(target);
				let anchor = document.createElement("a");
				anchor.download = "download." + type;
				anchor.href = canvas.toDataURL("image/" + type);
				// (B3) "FORCE DOWNLOAD"
				anchor.click();
				anchor.remove();
				// (B4) SAFER ALTERNATIVE - LET USER CLICK ON LINK
				//anchor.innerHTML = "Download";
				//document.body.appendChild(anchor);
			}
			function createCanvasImage() {
				var canvas = getElem("canvasWordFinderExport");
				var ctx = canvas.getContext('2d');
				var wordlength = gameState.Words[0].split("").length;
				var words = gameState.Words.length;
				var size = 80;
				var rectWidth = size;
				var rectHeight = size;
				canvas.setAttribute("width", (wordlength) * rectWidth + "px");
				canvas.setAttribute("height", (words + 5) * rectHeight + "px");
				ctx.font = (size / 2) + "px Impact";
				ctx.textAlign = "center";
				var totHeight = 0;
				var wordletters = chosenWord.split("");
				ctx.fillStyle = "rgba(200,200,200,1)";
				ctx.fillRect(0, 0, (wordlength) * rectWidth, (words + 5) * rectHeight);
				for (j = 0; j < words; j++) {
					var text = gameState.Words[j];
					for (i = 0; i < wordlength; i++) {
						ctx.fillStyle = text[i] == wordletters[i].toUpperCase() ? "rgba(0,150,0,1)" : wordletters.toUpperCase().indexOf(text[i]) > -1 ? "rgba(255,255,0,1)" : "rgba(255,0,0,1)";
						ctx.beginPath();
						ctx.rect(i * rectWidth, j * rectHeight, rectWidth, rectHeight);
						ctx.fillText(text[i], i * rectWidth + (rectWidth / 2), ((rectHeight / 2) + rectHeight * j) + rectHeight / 4);
						ctx.stroke();
					}
					totHeight++;
				}
				ctx.font = (size / 4) + "px Impact";
				ctx.fillStyle = "rgba(0,0,0,1)";
				ctx.beginPath();
				ctx.fillText(chosenWord, ((wordlength * rectWidth) / 2), ((rectHeight / 2) + rectHeight * (totHeight)) + rectHeight / 4);
				ctx.stroke();
				ctx.font = (size / 2) + "px Impact";
				totHeight++;
				var letter = 0;
				for (j = 0; j < 3; j++) {
					for (i = 0; i < 10; i++) {
						if(keyBoard.length - 1 > (letter)){
							var thisLetter = keyBoard[letter].L;
							thisLetter = thisLetter.replace(":)"," ").replace("<="," ");
							var multi = (chosenWord.toUpperCase().match(new RegExp(thisLetter.toUpperCase(), "g")) || []).length > 1;
							ctx.fillStyle = guessedLetters.indexOf(thisLetter.toUpperCase()) > -1 ? (wordletters.indexOf(thisLetter) > -1 ? (multi ? "rgba(255,127.5,0,1)" : "rgba(0,150,0,1)") : "rgba(255,0,0,1)") : "rgba(0,0,0,1)";
						} else{
							ctx.fillStyle = "rbga(0,0,0,1)"
						}
						ctx.beginPath();
						var wid = (wordlength * rectWidth) / 10;
						ctx.rect(i * wid, (j + totHeight) * rectHeight, wid, rectHeight);
						ctx.fillText(keyBoard.length - 1 < (letter) ? "" : keyBoard[letter].L, (i) * wid + (wid / 2), ((rectHeight / 2) + rectHeight * (j + totHeight)) + rectHeight / 4);
						ctx.stroke();
						letter++;
					}
				}
				totHeight++;
				totHeight++;
				totHeight++;
				ctx.font = (size / 4) + "px Impact";
				ctx.fillStyle = "rgba(0,0,0,1)";
				ctx.beginPath();
				ctx.fillText(window.location.protocol + "//" + window.location.hostname + window.location.pathname, ((wordlength * rectWidth) / 2), ((rectHeight / 2) + rectHeight * (totHeight)) + rectHeight / 4);
				ctx.stroke();
			}
		</script>
		<style id="adjustWordsTable">
		</style>
		<canvas id="canvasWordFinderExport" style="border:1px solid;display:none;"></canvas>